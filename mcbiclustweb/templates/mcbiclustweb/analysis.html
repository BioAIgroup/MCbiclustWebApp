{% extends 'mcbiclustweb/base.html' %}

{% block content %}

{% include "mcbiclustweb/navbar.html"%}

<div class="container pt-5">
    <h1>{{ analysis.name }}</h1>
    <hr class="mb-4" style="border-top: 2px solid rgba(0, 0, 0, 0.1);">
    <div class="container">
        <div class="row">
            <div class="col-md-3">
                <label><b>Description</b></label>
            </div>
            <div class="col-md-9">
                <p>{{ analysis.description }}</p>
            </div>
        </div>
        <div class="row">
            <div class="col-md-3">
                <label><b>Status</b></label>
            </div>
            <div class="col-md-9">
                <p>{{ analysis.status|title }}</p>
            </div>
        </div>
        <hr class="mb-2">
        {% if analysis.status == "pending" %}
        <div>
            <form id="startAnalysisForm" action="{% url 'mcbiclustweb:start' analysis.id %}" method="POST" novalidate="">
                {% csrf_token %}
                <div class="form-group">
                    <label for="seedSize">
                        Sample Seed Size
                        <small class="form-text text-muted">
                            Choose the sample size of your seed.
                        </small>
                    </label>
                    <input id="seedSize" class="form-control" name="seedSize" required="" min="1" type="number">
                    <div class="invalid-feedback">
                        Please provide an integer input.
                    </div>
                </div>
                <div class="form-group">
                    <label for="initSeed">
                        Initial Sample Seed
                        <small class="form-text text-muted">
                            Enter the initial sample seed separate by commas only. Note that if the number of initial sample seeds specified is not equal to Sample Seed Size, the algorithm will choose a random inital seed instead. (Optional)
                        </small>
                    </label>
                    <input id="initSeed" class="form-control" name="initSeed" type="text">
                    <div id="incorrectFormat" class="invalid-feedback">
                        Please verify the format you have entered is correct.
                    </div>
                </div>
                <div class="form-group">
                    <label for="iterations">
                        Iterations
                        <small class="form-text text-muted">
                            Choose the number of iterations to run each FindSeed algorithm.
                        </small>
                    </label>
                    <input id="iterations" class="form-control" name="iterations" min="1" required="" type="number">
                    <div class="invalid-feedback">
                        Please provide an integer input.
                    </div>
                </div>
                <div class="form-group">
                    <label for="numRuns">
                        Number of runs
                        <small class="form-text text-muted">
                            Choose the number of runs of the FindSeed algorithm.
                        </small>
                    </label>
                    <input id="numRuns" class="form-control" name="numRuns" required="" min="1" type="number">
                    <div class="invalid-feedback">
                        Please provide an integer input.
                    </div>
                </div>
                <input class="btn btn-primary btn-lg" type="submit" name="submit" value="Start Analysis">
            </form>
        </div>
        {% endif %}
    </div>
</div>

<script>
    $('document').ready(function() {
        var monitorInitSeed = false;
        function validateInitSeed(event=null) {
            monitorInitSeed = true;
            var initSeeds = $('#initSeed').val().split(',');
            for (var i = 0; i < initSeeds.length; i++) {
                if (isNaN(initSeeds[i])) {
                    $('#incorrectFormat').css('display', 'block');
                    $('#initSeed').css('border-color', '#dc3545');
                    if (event !== null) {
                        event.preventDefault();
                        event.stopPropagation();
                    }
                    break;
                } else {
                    $('#incorrectFormat').css('display', 'none');
                    $('#initSeed').css('border-color', '#28a745');
                }
            }
        }

        var startAnalysisForm = document.getElementById('startAnalysisForm');
        $('#startAnalysisForm').submit(function( event ) {
            if (startAnalysisForm.checkValidity() === false) {
                event.preventDefault();
                event.stopPropagation();
            }
            validateInitSeed(event);

            $('#startAnalysisForm').addClass("was-validated");
        });

        $('#initSeed').keydown(function() {
            console.log('change')
            if (monitorInitSeed)
                validateInitSeed();
        });
    });
</script>

{% endblock %}